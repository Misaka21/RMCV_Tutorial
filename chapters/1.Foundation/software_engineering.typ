=== 设计模式的起源
*设计模式*(Design pattern)是软件开发者在长期实践中提炼出的、可复用的代码设计经验，它们经过大量项目验证，被系统化分类，并形成了完整的知识体系。设计模式是软件工程的基石脉络，如同大厦的结构一样。

设计模式使代码编制真正工程化，是软件工程的基石。在项目中合理地运用设计模式可以完美地解决很多问题，每种模式在现实中都有相应的原理来与之对应，且都描述了一个在我们周围不断重复发生的问题，以及该问题的核心解决方案，这也是设计模式能被广泛应用的原因。

1994 年，Erich Gamma、Richard Helm、Ralph Johnson 与 John Vlissides 四人共同出版了划时代的著作 #text(weight: "bold", style: "italic")[Design Patterns: Elements of Reusable Object-Oriented Software]（中文译名：《设计模式——可复用面向对象软件的基础》）。该书首次系统化地阐述了软件开发中"设计模式"这一核心概念，为面向对象软件设计奠定了理论基石。

在这本书中，GoF 将设计模式系统地归纳为三大类，共提出了 *"23 种经典设计模式"*，这些模式奠定了面向对象软件设计的基础框架。

然而需要指出的是，书中讨论的许多模式主要基于 *Java* 等当时主流的面向对象语言。在 *C++* ——尤其是 *现代 C++*（Modern C++）的发展背景下，由于语言本身拥有更强大的表达能力（如 RAII、模板、智能指针、`constexpr` 等特性），其中部分设计模式已不再必要，甚至被语言机制自然替代。

尽管如此，现代软件工程仍将设计模式分为三大类：

1. *创建型模式（Creational Patterns）*\
   关注对象的创建方式，以提升灵活性与可扩展性。

2. *结构型模式（Structural Patterns）*\
   关注类与对象的组织结构，使系统模块更清晰、更易复用。

3. *行为型模式（Behavioral Patterns）*\
   关注对象间的协作方式与职责划分，提升系统行为的稳定性与扩展性。

这些模式依然构成理解现代架构思想的重要基础，只是在 C++ 语境下，其实现方式随着语言进化而更为简洁与自然。

=== 设计模式的基本原则

设计模式的*核心目标*是实现*高内聚、低耦合*的软件架构。所谓"高内聚"，是指一个模块内部的各个元素紧密相关、职责明确；而"低耦合"则强调模块之间的依赖关系应尽可能松散，以便于系统的维护、扩展与升级。

为了达成这一目标，软件工程界总结出了以下*七大设计原则*，它们共同构成了设计模式的理论基石：

1. *开闭原则 (Open-Closed Principle, OCP)*

*对扩展开放，对修改关闭。*

软件实体（类、模块、函数等）应当在不修改现有代码的前提下进行功能扩展。这一原则是实现系统良好扩展性与可维护性的关键。想要达到这样的效果，需要充分利用接口、抽象类等机制，将易变部分与稳定部分分离。

开闭原则是设计模式的总纲，其他原则都是实现开闭原则的具体手段。

2. *单一职责原则 (Single Responsibility Principle, SRP)*

*一个类应该只有一个引起它变化的原因。*

类的职责应当单一明确，对外只提供一种功能。当一个类承担的职责过多时，这些职责之间可能会相互耦合，一个职责的变化可能会削弱或抑制这个类完成其他职责的能力。遵循单一职责原则可以提高类的可读性、可维护性，降低变更引起的风险。

3. *里氏替换原则 (Liskov Substitution Principle, LSP)*

*任何基类可以出现的地方，子类一定可以出现。*

里氏替换原则是面向对象设计的基本原则之一，是继承复用的基石。它要求子类在继承父类时，除了添加新的方法完成新增功能外，尽量不要重写父类的方法。只有当派生类可以替换掉基类，且软件单位的功能不受影响时，基类才能真正被复用。

里氏替换原则是对开闭原则的补充，它通过规范继承关系来实现抽象化，从而支撑开闭原则的实现。这一原则在 C++ 中通过虚函数机制在语言层面得到了实现。

4. *依赖倒置原则 (Dependence Inversion Principle, DIP)*

*依赖于抽象，不要依赖于具体实现。*

高层模块不应该依赖低层模块，两者都应该依赖其抽象（接口或抽象类）。抽象不应该依赖细节，细节应该依赖抽象。这一原则是开闭原则的基础，强调"面向接口编程"而非"面向实现编程"，从而降低模块间的耦合度。

5. *接口隔离原则 (Interface Segregation Principle, ISP)*

*使用多个专门的接口，而不使用单一的总接口。*

客户端不应该被迫依赖它不使用的接口方法。一个接口应该只提供一种对外功能，不应该把所有操作都封装到一个接口中。接口隔离原则要求将臃肿的接口拆分为多个细粒度的接口，降低类之间的耦合度，提高系统的灵活性。

6. *合成复用原则 (Composite Reuse Principle, CRP)*

*优先使用对象组合，而不是继承来达到复用的目的。*

在复用代码时，应优先选择对象组合（一个对象包含另一个对象）的方式，而不是使用类继承。继承会导致父类的任何变化都可能影响到子类的行为，增加了系统的脆弱性；而对象组合则降低了这种依赖关系，使系统更加灵活。这一原则是对里氏替换原则的补充，提示我们思考功能组合实现的正确方式。

7. *迪米特法则 (Law of Demeter, LoD)*

*一个对象应当对其他对象有尽可能少的了解。*

也称为*最少知识原则*，要求一个实体应当尽量少地与其他实体发生相互作用，使得系统功能模块相对独立，从而降低各个对象之间的耦合，提高系统的可维护性。

例如在程序设计中，各个模块之间相互调用时，通常会提供一个统一的接口来实现功能。这样其他模块不需要了解模块内部的实现细节（黑盒原理），当一个模块内部的实现发生改变时，不会影响其他模块的使用。
